# Redirect 80 -> 443
:80 {
  redir https://{host}{uri} permanent
}

# Self-signed TLS for local/dev
:443 {
  tls internal

  # FastAPI at /
  handle {
    reverse_proxy api:8000
  }

  # pgAdmin at /pg
  handle_path /pg* {
    reverse_proxy pgadmin:80
  }

  # pgweb (source) at /src
  handle_path /src* {
    reverse_proxy pgweb_src:8081
  }

  # pgweb (destination) at /dest
  handle_path /dest* {
    reverse_proxy pgweb_dst:8081
  }
}
